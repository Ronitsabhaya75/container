name: Stale PR and Issue Management

on:
  schedule:
    - cron: '*/5 * * * *'  # TEST: Every 5 minutes for testing
  workflow_dispatch:
  pull_request:
    branches:
      - test-stale-workflow  # Only run on test branch

permissions:
  contents: read

jobs:
  stale:
    name: Mark stale issues and PRs
    runs-on: ubuntu-latest
    
    permissions:
      issues: write
      pull-requests: write
    
    steps:
      - name: Run stale action
        uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
          days-before-stale: 0  # TEST: 0 days = marks stale immediately
          days-before-close: 0  # TEST: 0 days = closes on next run
          
          stale-pr-message: |
            ‚ö†Ô∏è **TEST MODE** - This PR has been inactive and will be marked as stale for testing purposes.
            
            If you're still working on this, please:
            - Update the PR with recent changes
            - Respond to any review comments
            - Rebase on the latest main branch
            
            The PR will be closed in 14 days if there's no activity.
            
            If you need help or have questions, feel free to ask! We appreciate your contribution. üôè
          
          close-pr-message: |
            This pull request was automatically closed due to inactivity.
            
            If you'd like to continue this work, feel free to:
            - Reopen this PR with updates
            - Create a new PR with a fresh rebase
            - Comment here if you need assistance
            
            Thank you for your contribution! ‚ù§Ô∏è
          
          stale-pr-label: 'stale'
          
          days-before-issue-stale: 0  # TEST: 0 days = marks stale immediately
          days-before-issue-close: 0  # TEST: 0 days = closes on next run
          
          stale-issue-message: |
            ‚ö†Ô∏è **TEST MODE** - This issue has been inactive and will be marked as stale for testing purposes.
            
            If this is still relevant, please:
            - Provide an update or additional context
            - Confirm you can still reproduce the issue
            - Let us know if you're working on a fix
            
            The issue will be closed in 30 days if there's no activity.
          
          close-issue-message: |
            This issue was automatically closed due to inactivity.
            
            If this is still a problem, feel free to:
            - Reopen with updated information
            - Create a new issue with current details
            
            Thank you for reporting! üôè
          
          stale-issue-label: 'stale'
          
          exempt-pr-labels: 'security,critical,in-progress,on-hold,dependencies'
          exempt-issue-labels: 'security,critical,roadmap,pinned,on-hold,help-wanted,good-first-issue'
          
          operations-per-run: 100
          remove-stale-when-updated: true
          
          ascending: false
          exempt-all-milestones: false
          
          debug-only: True
